# üõ°Ô∏è OmniMind Privileged Execution Policy
# Define quais comandos o agente pode executar com privil√©gios (sudo) e quais devem ser isolados.

policy_version: "1.1"

# ‚úÖ Comandos permitidos no Host (System) via Sudo
# Estes comandos ser√£o executados com `sudo -n` (non-interactive).
# Requer configura√ß√£o no /etc/sudoers (ver scripts/setup_permissions.sh).
system_allowlist:
  # --- OBSERVABILITY & KERNEL ---
  - name: "eBPF Monitor"
    command: "/usr/bin/bpftrace"
    args_regex: "^scripts/canonical/system/monitor_mcp_bpf\\.bt$"
    risk: "high"
    description: "Monitoramento de seguran√ßa do kernel via eBPF"

  - name: "System Logs"
    command: "/usr/bin/journalctl"
    args_regex: ".*"
    risk: "low"
    description: "Leitura de logs do sistema para diagn√≥stico"

  - name: "Kernel Messages"
    command: "/usr/bin/dmesg"
    args_regex: ".*"
    risk: "low"
    description: "Leitura de logs do kernel"

  # --- NETWORK SECURITY ---
  - name: "Network Scan (Local)"
    command: "/usr/bin/nmap"
    args_regex: "^(-sS|-sT|-O|-p).*127\\.0\\.0\\.1.*|^(-sS|-sT|-O|-p).*localhost.*"
    risk: "medium"
    description: "Scan de portas locais para verifica√ß√£o de seguran√ßa"

  - name: "Socket Statistics"
    command: "/usr/bin/ss"
    args_regex: "^-.*"
    risk: "low"
    description: "Visualiza√ß√£o de sockets e processos (substituto do netstat)"

  - name: "Packet Capture"
    command: "/usr/bin/tcpdump"
    args_regex: "^-i (lo|eth0|wlan0|docker0) .*"
    risk: "high"
    description: "Captura de tr√°fego para an√°lise forense"

  - name: "Firewall Management"
    command: "/usr/sbin/iptables"
    args_regex: "^(-A|-D|-I|-L) (INPUT|OUTPUT|FORWARD).*"
    risk: "high"
    description: "Gerenciamento de regras de firewall (bloqueio de IPs)"

  # --- PROCESS MANAGEMENT ---
  - name: "Process Cleanup"
    command: "/usr/bin/pkill"
    args_regex: "^-f.*"
    risk: "medium"
    description: "Limpeza de processos travados (uvicorn, python, node)"

  - name: "Service Management"
    command: "/usr/bin/systemctl"
    args_regex: "^(status|restart|stop|start) (nginx|docker|omnimind).*"
    risk: "medium"
    description: "Gerenciamento de servi√ßos essenciais"

  # --- HARDWARE & STORAGE ---
  - name: "Disk Health"
    command: "/usr/sbin/smartctl"
    args_regex: "^-a /dev/.*"
    risk: "low"
    description: "Verifica√ß√£o de sa√∫de de discos (S.M.A.R.T)"

  - name: "Docker Management"
    command: "/usr/bin/docker"
    args_regex: ".*"
    risk: "medium"
    description: "Gerenciamento de containers"

# üê≥ Comandos que DEVEM rodar em Docker (Isolados)
# Se o agente tentar rodar isso no host com sudo, ser√° bloqueado e redirecionado.
docker_enforced:
  - "npm install"
  - "pip install"
  - "rm -rf"
  - "dd"
  - "mkfs"
  - "fdisk"
  - "wget"
  - "curl -O"

# üìù Configura√ß√£o de Auditoria
audit:
  log_file: "logs/audit/privileged_access.log"
  log_format: "{timestamp} | {user} | {status} | {command} | {reason}"
