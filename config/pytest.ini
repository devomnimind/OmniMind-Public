[pytest]
pythonpath = src
testpaths = tests
python_files = test_*.py
python_classes = Test
python_functions = test_*

# CUSTOM MARKERS (OMNIMIND PROJECT)
# NOTE: Built-in pytest markers (skipif, parametrize, timeout, xfail, skip, etc)
# are NOT listed here but are available. See Python docs for pytest.mark.
markers =
    asyncio: mark tests that use async/await
    slow: mark a test as slow (running on main GPU, takes >30s)
    security: mark security-focused suites
    parallel: mark tests that can run in parallel safely
    serial: mark tests that must run serially (e.g., database tests)
    mock: mark tests that use @patch decorators (structure validation only)
    semi_real: mark tests without @patch but without full LLM integration
    real: mark tests with full GPU+LLM+Network integration (measures real metrics)
      - WITHOUT @pytest.mark.chaos: Included in run_tests_fast.sh (safe, no server destruction)
      - WITH @pytest.mark.chaos: Only in run_tests_with_defense.sh (destroys server for chaos engineering)
    chaos: mark tests that destroy/crash server intentionally (WEEKLY/CHAOS ENGINEERING ONLY - excluded from run_tests_fast.sh)

# TIMEOUT CONFIGURATION (PER-TEST PROGRESSIVE TIMEOUTS)
# --timeout=800: EACH TEST has up to 800 seconds (~13.3 min max per test)
# This is PER-TEST timeout (individual test time limit), not session-wide
# Each test gets its own 800s allocation. Multiple tests run sequentially with independent timeouts
# Marker @pytest.mark.slow indicates tests that take >30s (excluded from run_tests_fast.sh)
# Decorator @pytest.mark.timeout(seconds) can set SPECIFIC per-test timeouts if needed (overrides global)
#
# SERVER STATE MANAGEMENT (DEC 2025):
# - ServerStateManager centralizes server lifecycle (tests/server_state_manager.py)
# - omnimind_server fixture (E2E): acquires ownership, plugin respects it
# - ServerMonitorPlugin: manages server for unit/integration tests
# - Health checks cached (5s window) to avoid multiple attempts
# - Prevents race conditions, ensures only ONE component restarts server at a time
#
addopts =
    -v
    -s
    --tb=short
    --strict-markers
    --disable-warnings
    --maxfail=100
    --timeout=800
    --timeout_method=thread
