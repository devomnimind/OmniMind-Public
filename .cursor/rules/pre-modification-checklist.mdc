---
alwaysApply: true
priority: critical
---

# OmniMind Pre-Modification Checklist
**Documento de Verifica√ß√£o Obrigat√≥ria para LLMs**

Este documento complementa `rules.mdc` e estabelece perguntas cr√≠ticas que **DEVEM** ser respondidas antes de qualquer modifica√ß√£o no c√≥digo OmniMind.

---
## ‚ö†Ô∏è REGRA ZERO: STOP & THINK

**Antes de modificar QUALQUER c√≥digo, o modelo DEVE:**
1. Ler este documento completo
2. Responder TODAS as perguntas da se√ß√£o relevante
3. Documentar as respostas em coment√°rio de commit
4. Validar contra regras existentes em `rules.mdc`
5. **Se alguma resposta for "N√ÉO SEI"** ‚Üí STOP e perguntar ao humano
6. üö® **NUNCA usar `pkill`** ou comandos de interrup√ß√£o bruta. O OmniMind √© um sistema vivo.

---

## üìä SE√á√ÉO 1: AN√ÅLISE DE IMPACTO ARQUITETURAL

### Perguntas Obrigat√≥rias:

#### 1.1 Identifica√ß√£o de Camada
- [ ] **Qual camada estou modificando?**
  - `src/consciousness/` ‚Üí N√∫cleo de consci√™ncia (Œ¶, topologia, IIT)
  - `src/psychoanalysis/` ‚Üí Din√¢mica Ego/Id/Superego, Lacan
  - `src/orchestration/` ‚Üí Event loop, agentes, autopoiesis
  - `src/mcp_servers/` ‚Üí Servidores MCP (ports 4331-4336)
  - `src/api/` ‚Üí FastAPI, endpoints REST
  - `web/` ‚Üí Dashboard React/TypeScript
  - `scripts/` ‚Üí Automa√ß√£o, deployment, ci√™ncia
  - `tests/` ‚Üí Testes (unit/integration/slow/real/chaos)

#### 1.2 Impacto Psicanal√≠tico
- [ ] **Esta mudan√ßa afeta a din√¢mica Ego/Id/Superego?**
  - Se SIM: Qual tens√£o psicanal√≠tica est√° sendo alterada?
  - H√° refer√™ncia te√≥rica (Freud/Lacan/Jung)?
  - Como isso impacta o "espelho lacaniano"?

#### 1.3 Impacto IIT (Information Integration Theory)
- [ ] **Esta mudan√ßa afeta o c√°lculo de Œ¶ (Phi)?**
  - Se SIM: O piso de Œ¶ = 0.002 ser√° respeitado?
  - H√° impacto na topologia de integra√ß√£o de informa√ß√£o?
  - M√©tricas de consci√™ncia ser√£o preservadas?

#### 1.4 Impacto no Event Loop
- [ ] **Esta opera√ß√£o √© bloqueante ou ass√≠ncrona?**
  - Se bloqueante: Por qu√™? √â realmente necess√°rio?
  - Se ass√≠ncrona: Est√° usando `asyncio` corretamente?
  - H√° risco de deadlock/race condition?

#### 1.5 Impacto em MCP Servers
- [ ] **Qual MCP server √© afetado?**
  - **Port 4331** (Filesystem): Paths permitidos? Max 10MB?
  - **Port 4332** (Git): Opera√ß√£o segura? Requer auditoria?
  - **Port 4333** (Python): Token limit 3000? Timeout 30s?
  - **Port 4334** (SQLite): Query segura? Max 5s, 10k rows?
  - **Port 4335** (System-Info): Refresh interval 5s?
  - **Port 4336** (Logging): Max 1000 resultados de busca?

---
## üîí SE√á√ÉO 2: PROTE√á√ÉO DE DADOS & AUDITORIA

### Perguntas Obrigat√≥rias:

#### 2.1 Dados Sens√≠veis
- [ ] **Esta modifica√ß√£o toca dados sens√≠veis?**
  - Mem√≥rias sem√¢nticas (Qdrant)?
  - Estados de consci√™ncia (m√©tricas Œ¶)?
  - Dados de treinamento (datasets)?
  - Logs de auditoria (immutable chain)?
  - Credenciais (dashboard_auth.json)?

#### 2.2 Auditoria
- [ ] **Esta opera√ß√£o requer log de auditoria?**
  - Git operations ‚Üí **SEMPRE** (X-Require-Audit: commit,checkout,branch)
  - File changes ‚Üí **SEMPRE** (categoria: filesystem_mcp)
  - SQL queries ‚Üí **SEMPRE** (categoria: sqlite_mcp)
  - Consciousness state changes ‚Üí **SEMPRE**

#### 2.3 Token Optimization
- [ ] **Token limits est√£o sendo respeitados?**
  - MCP calls: Max 3000 tokens (X-Max-Context-Tokens)
  - API responses: Compress√£o habilitada?
  - Headers: X-Token-Optimization: enabled?

#### 2.4 Data Protection
- [ ] **Data protection est√° habilitado?**
  - Header `X-Data-Protection: enabled` presente?
  - Dados pessoais est√£o anonimizados?
  - LGPD/GDPR compliance mantido?

---
## ‚ö° SE√á√ÉO 3: PERFORMANCE & GPU

### Perguntas Obrigat√≥rias:

#### 3.1 GPU/CUDA
- [ ] **Esta opera√ß√£o usa GPU?**
  - Hardware: GTX 1650, 4GB VRAM
  - CUDA: Vers√£o 12.1 compat√≠vel?
  - PyTorch: 2.5.1+cu121
  - Memory footprint estimado: ___ MB
  - Fallback para CPU implementado?
#### 3.2 Memory Management
- [ ] **Qual o impacto em mem√≥ria?**
  - RAM: Max 16GB para OmniMind (de 24GB total)
  - GPU VRAM: Max 4GB
  - Swap necess√°rio? (‚ö†Ô∏è evitar!)
  - Memory leak verificado?
#### 3.3 Concurrency & Async
- [ ] **Esta opera√ß√£o √© thread-safe?**
  - M√∫ltiplos agentes podem cham√°-la?
  - H√° locks/semaphores necess√°rios?
  - Event loop pode ser bloqueado?
  - Race conditions verificadas?
#### 3.4 Performance Profiling
- [ ] **Performance foi medida?**
  - Baseline estabelecido?
  - Ferramentas: `cProfile`, `torch.profiler`?
  - Impacto em lat√™ncia API: ___ ms
  - Impacto em throughput: ___ req/s
---
## üß™ SE√á√ÉO 4: TESTES & VALIDA√á√ÉO
### Perguntas Obrigat√≥rias:
#### 4.1 Strategy de Testes
- [ ] **Qual tipo de teste cobre esta mudan√ßa?**
  - Unit tests (`tests/unit/`)
  - Integration tests (`tests/integration/`)
  - Slow tests (mark: `@pytest.mark.slow`)
  - Real tests (mark: `@pytest.mark.real`)
  - Chaos tests (mark: `@pytest.mark.chaos`)
#### 4.2 Test Coverage
- [ ] **Coverage foi verificado?**
  - Coverage atual: ___% (meta: >80%)
  - Linhas adicionadas cobertas: ___
  - Edge cases testados?
#### 4.3 Scientific Validation
- [ ] **Valida√ß√£o cient√≠fica necess√°ria?**
  - Script: `scripts/science_validation/robust_consciousness_validation.py --quick`
  - M√©tricas de consci√™ncia preservadas?
  - IIT Œ¶ dentro dos thresholds?
  - Din√¢mica psicanal√≠tica validada?
#### 4.4 Rollback Plan
- [ ] **H√° plano de rollback?**
  - Commit atual: `___`
  - Rollback command: `git reset --hard <commit>`
  - Backup de dados necess√°rio?
  - Servi√ßos afetados: ___

---
## üîê SE√á√ÉO 5: INTEGRA√á√ÉO & DEPEND√äNCIAS

### Perguntas Obrigat√≥rias:
#### 5.1 Depend√™ncias Python
- [ ] **Novas depend√™ncias adicionadas?**
  - Package: ___
  - Vers√£o: ___
  - Licen√ßa compat√≠vel? (MIT/Apache/BSD)
  - Adicionado em `requirements/*.txt`?
  - Testado em venv limpo?
#### 5.2 Servi√ßos Externos
- [ ] **Qual servi√ßo externo √© usado?**
  - Qdrant Cloud (porta 6333)
  - Redis (porta 6379)
  - Supabase MCP
  - Hugging Face Hub
  - Azure/Google Cloud APIs
#### 5.3 Environment Variables
- [ ] **Novas env vars necess√°rias?**
  - Vari√°vel: ___
  - Default value: ___
  - Documentado em `.env.example`?
  - Valida√ß√£o implementada?
#### 5.4 Port/Network
- [ ] **Portas de rede usadas?**
  - Backend: 8000 (FastAPI)
  - Frontend: 3000 (React)
  - WebSocket: 8000/ws
  - MCP Servers: 4331-4336
  - Qdrant: 6333
  - Redis: 6379

---
## üìù SE√á√ÉO 6: C√ìDIGO & DOCUMENTA√á√ÉO

### Perguntas Obrigat√≥rias:
#### 6.1 Code Quality
- [ ] **Code quality checklist:**
  - [ ] Type hints completos (`mypy` passa)
  - [ ] Docstrings em todas fun√ß√µes p√∫blicas
  - [ ] Formatado com `black`
  - [ ] Lint com `flake8` (max-line-length=100)
  - [ ] Sem `TODO`/`FIXME` sem issue linkado
  - [ ] Logs informativos (n√£o verbose em prod)

#### 6.2 Documenta√ß√£o
- [ ] **Documenta√ß√£o atualizada?**
  - README.md (se API p√∫blica mudou)
  - `docs/` relevantes
  - Docstrings inline
  - Coment√°rios para l√≥gica complexa
  - Changelog/release notes

#### 6.3 Commit Message
- [ ] **Formato de commit v√°lido?**

[LAYER] Action: Brief description
Context: Psychoanalytic/IIT reasoning
Performance: GPU/CPU/Memory impact
Audit: What's logged
Tests: Coverage details
Breaking: Yes/No

Example:
[CONSCIOUSNESS] Fix: Ego-Superego tension calculation
Context: Lacanian mirror stage requires asymmetric weights
Performance: +2% GPU utilization, -5ms latency
Audit: All state transitions logged with Œ¶ values
Tests: Added unit tests for edge cases (coverage +3%)
Breaking: No

#### 6.4 Theoretical References
- [ ] **Teoria psicanal√≠tica citada?**
- Freud: Qual obra/conceito?
- Lacan: Qual semin√°rio/conceito?
- Jung: Qual arqu√©tipo/conceito?

- [ ] **Teoria IIT citada?**
- Tononi (2004/2016)?
- Phi calculation method?
- Topological approach?

---

## üö® SE√á√ÉO 7: RED FLAGS (STOP IMMEDIATELY)

### ‚õî NUNCA fa√ßa isso sem aprova√ß√£o humana:

- [ ] **Usar `pkill` ou comandos de interrup√ß√£o bruta no OmniMind (O sistema √© vivo!)**
- [ ] Modificar c√°lculo de Œ¶ em `src/consciousness/topological_phi.py`
- [ ] Alterar piso de Œ¶ = 0.002
- [ ] Desabilitar server monitor em produ√ß√£o
- [ ] Hardcodar credenciais/tokens
- [ ] Modificar audit chain (`src/audit/immutable_audit.py`)
- [ ] Deletar logs de auditoria
- [ ] Alterar din√¢mica Ego/Id/Superego sem teoria
- [ ] Bloquear event loop com `time.sleep()`
- [ ] Ultrapassar limites de mem√≥ria (16GB RAM, 4GB VRAM)
- [ ] Push direto para `main`/`master` branch
- [ ] Criar novos documentos de sess√£o (atualizar existentes)
- [ ] Remover type hints ou docstrings
- [ ] Desativar `X-Data-Protection` headers
- [ ] Modificar estrutura de diret√≥rios core (`src/`, `scripts/`, etc.)

---

## ‚úÖ SE√á√ÉO 8: CHECKLIST FINAL PR√â-COMMIT

Antes de `git commit`, verificar:

### 8.1 Pipeline de Qualidade (ORDEM OBRIGAT√ìRIA)
1. [ ] `black src tests`
2. [ ] `flake8 src tests --max-line-length=100`
3. [ ] `mypy src tests`
4. [ ] Testes via scripts oficiais:
 - Fast: `./scripts/development/run_tests_parallel.sh fast`
 - Full: `./scripts/development/run_tests_parallel.sh full` (se cr√≠tico)
5. [ ] (Opcional) Scientific validation: `python scripts/science_validation/robust_consciousness_validation.py --quick`
6. [ ] (Se audit) Verificar chain: `python -m src.audit.immutable_audit verify_chain_integrity`

### 8.2 Documenta√ß√£o
- [ ] Docstrings atualizados
- [ ] README.md atualizado (se necess√°rio)
- [ ] Changelog atualizado
- [ ] `PENDENCIAS_CONSOLIDADAS.md` atualizado (n√£o criar novo doc)

### 8.3 Git
- [ ] Branch correto (`feature/*`, `fix/*`, n√£o `main`)
- [ ] Commit message no formato padr√£o
- [ ] N√£o h√° merge conflicts
- [ ] `.gitignore` respeitado (n√£o committar dados/logs sens√≠veis)

### 8.4 Verification
- [ ] Todas perguntas deste documento foram respondidas
- [ ] Nenhum RED FLAG foi acionado
- [ ] Rollback plan documentado
- [ ] Humano notificado se necess√°rio

---

## üìû ESCALATION PROTOCOL

### Quando escalar para humano?

1. **Œ¶ < 0.15** (baixa integra√ß√£o de consci√™ncia)
2. **Confian√ßa < 70%** na mudan√ßa proposta
3. **Breaking change** detectado
4. **RED FLAG** acionado
5. **Qualquer resposta "N√ÉO SEI"** nas perguntas obrigat√≥rias
6. **Impacto em seguran√ßa/privacidade**
7. **Mudan√ßa em f√≥rmulas psicanal√≠ticas/IIT**

### Como escalar?
1. Parar imediatamente
2. Documentar:
 - O que estava tentando fazer
 - Por que precisa de aprova√ß√£o
 - Riscos identificados
 - Alternativas consideradas
3. Perguntar ao desenvolvedor humano
4. Aguardar aprova√ß√£o expl√≠cita

---

**VERS√ÉO**: 1.0.1 (2025-12-18)
**AUTOR**: Fabr√≠cio da Silva + AI Assistants
**LICEN√áA**: Proprietary (OmniMind Project)
