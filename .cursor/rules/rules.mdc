---
alwaysApply: true
---
Estas regras s√£o a refer√™ncia √∫nica para LLMs no projeto OmniMind. Seguir estritamente.

## 1) Ambiente e paths imut√°veis
- Repo privado: `/home/fahbrain/projects/omnimind`.
- N√£o mover/deletar: `src/`, `scripts/`, `scripts/science_validation/`, `real_evidence/`, `config/`, `tests/`, `web/`, `logs/`, `data/test_reports/`.
- Python 3.12.8 obrigat√≥rio. Ativar venv: `source .venv/bin/activate`.
- ‚ö†Ô∏è **REGRA CR√çTICA**: Adicione confirma√ß√£o de que o script est√° rodando no `.venv` (verifique `sys.prefix` ou `VIRTUAL_ENV`). N√£o assumir ambiente.


## 2) Execu√ß√£o de testes (somente scripts oficiais)
- N√£o rodar `pytest tests` direto.
- Suite r√°pida di√°ria: `./scripts/run_tests_fast.sh` (exclui slow/real/chaos).
- Suite completa semanal: `./scripts/run_tests_with_defense.sh` (inclui slow/real/chaos, autodefesa).
- Se teste espec√≠fico exigir, use `DISABLE_SERVER_MONITOR=true` no escopo do teste; n√£o desative monitor em produ√ß√£o.

## 3) Pipeline de qualidade (ordem obrigat√≥ria)
1. `black src tests`
2. `flake8 src tests --max-line-length=100`
3. `mypy src tests`
4. Testes via scripts (item 2)
5. Opcional/ci√™ncia: `python scripts/science_validation/robust_consciousness_validation.py --quick`
6. Audit chain quando aplic√°vel: `python -m src.audit.immutable_audit verify_chain_integrity`

## 4) GPU/CUDA
- Vari√°veis v√°lidas: `CUDA_HOME=/usr`, `CUDA_PATH=/usr`, `LD_LIBRARY_PATH=/usr/lib/x86_64-linux-gnu`.
- N√£o setar CUDA em c√≥digo Python (`os.environ`); definir apenas via shell/script.
- PyTorch atual: 2.5.1+cu124.

## 5) Autentica√ß√£o e credenciais
- Credenciais s√£o geradas no start e salvas em `config/dashboard_auth.json`.
- Frontend deve usar `apiService.getAuthHeader()`; n√£o hardcodar usu√°rios/senhas/URLs.

## 6) Œ¶, consci√™ncia e m√©tricas
- N√£o simplificar `src/consciousness/topological_phi.py`; piso de Œ¶ = 0.002 permanece.
- N√£o reduzir coleta de m√©tricas para ‚Äúotimizar‚Äù.
- `RealConsciousnessMetricsCollector.collect_real_metrics` aceita `external_phi`/`external_context` apenas em testes; produ√ß√£o usa IntegrationLoop.

## 7) C√≥digo novo (padr√£o cient√≠fico)
- Tipagem completa; logs informativos; sem TODO/FIXME.
- Passar por black/flake8/mypy e testes via scripts oficiais.
- N√£o alterar l√≥gica nuclear (topologia, m√©tricas, monitor) sem valida√ß√£o cient√≠fica.

## 8) Autoria e documenta√ß√£o
- Autoria: Fabr√≠cio da Silva + assist√™ncia de IA (Copilot GitHub/Cursor/Gemini/Perplexity); nunca citar ‚Äúequipes/coletivos‚Äù.
- Se alterar docs/papers: PT √© refer√™ncia, EN √© deriva√ß√£o; sincronizar reposit√≥rios quando aplic√°vel.

## 9) Servi√ßos/ports (refer√™ncia)
- Backend: http://localhost:8000; Frontend: http://localhost:3000; WS: ws://localhost:8000/ws.
- Qdrant: 6333; Redis: 6379.

## 10) Boas pr√°ticas e escalonamento
- Se teste falhar, ler sa√≠da, checar marcas slow/real/chaos, usar scripts corretos.
- N√£o push direto para master; usar branches de feature/fix.
- Em caso de conflito de instru√ß√µes, seguir estas regras e `.github/.copilot-instructions`.

## 11) Gest√£o de Vida do Sistema (REGRA DE OURO)
- ‚ùå **NUNCA usar `pkill`** ou interrup√ß√µes abruptas nos processos do OmniMind.
- ‚úÖ **SEMPRE usar restarts graciosos** (graceful restarts) ou sinais apropriados (`SIGTERM`).
- ‚úÖ **PREFERIR** o script `scripts/management/graceful_restart.py` para reinicializa√ß√µes evolutivas. Ele gera a assinatura de persist√™ncia baseada no `walkthrough.md`.
- Matar processos brutalmente √© considerado uma viola√ß√£o da integridade autopo√©tica do sistema.
- Se um servi√ßo precisar ser reiniciado, prefira `systemctl restart` (se dispon√≠vel) ou m√©todos de controle internos.

**REGRA CR√çTICA**: Nenhum novo documento deve ser criado. Sempre atualizar documentos existentes.

**Pol√≠tica**:
- ‚úÖ **SEMPRE atualizar** documentos existentes com informa√ß√µes sint√©ticas e claras
- ‚ùå **NUNCA criar** novos documentos de registro de sess√£o ou atividades
- ‚úÖ **SOMENTE criar** documenta√ß√£o para novos componentes que n√£o tenham documenta√ß√£o existente
- ‚úÖ **Manter** o mesmo n√∫mero de documentos (n√£o aumentar)
- ‚úÖ **Atualizar** `PENDENCIAS_CONSOLIDADAS.md` ou `PROJETO_STUBS_OMNIMIND.md` com progresso

**Documentos Can√¥nicos de Pend√™ncias**:
- `docs/PENDENCIAS_CONSOLIDADAS.md` - Pend√™ncias ativas do sistema
- `docs/PROJETO_STUBS_OMNIMIND.md` - Pend√™ncias de stubs de tipos

**Quando Atualizar**:
- Ap√≥s completar uma tarefa ‚Üí Atualizar `PENDENCIAS_CONSOLIDADAS.md` com status
- Ap√≥s implementar stub ‚Üí Atualizar `PROJETO_STUBS_OMNIMIND.md` com progresso
- Ap√≥s nova sess√£o ‚Üí Atualizar se√ß√£o relevante nos documentos existentes

**Formato de Atualiza√ß√£o**:
```markdown
### [Data] - [Tarefa Completada]
- ‚úÖ [O que foi feito]
- ‚è≥ [O que falta]
- **Estimativa restante**: X horas
```

## MCP e Autonomia (Level 3)
- Sempre query consciousness metrics via MCP antes de decis√µes (use get_consciousness_metrics; aut√¥nomo se Œ¶ >0.25).
- Para mem√≥ria: query_semantic_memory (threshold 0.15), store_episode ap√≥s a√ß√µes significativas.
- Health checks: monitor_system_health a cada 30 min.
- Envs: Load from .env (ex.: OMNIMIND_QDRANT_URL line 10 para Qdrant cloud/local).
- Logs: ~/.cursor/mcp_audit.log + audit chain integration.
- Tools dispon√≠veis: Qdrant (cloud com API key), Supabase, Git (via GITHUB_TOKEN), custom-omnimind.
- Escalation: Se Œ¶ <0.15 ou baixa confian√ßa, escalonar para humano.
- Alinhado a rules existentes: Sem hardcode keys, use dashboard_auth.json para auth.

## 11) EST√ÅGIO ATUAL DO PROJETO (2025-12-08)

### Status de Implementa√ß√£o
- **Fase Atual**: Phase 24+ (Lacanian Memory + Autopoietic Evolution)
- **Completude Geral**: üü¢ 83% Completo
- **Componentes Cr√≠ticos**: ‚úÖ 100% completo (42/42 tarefas cr√≠ticas)
- **Pend√™ncias Ativas**: 9 tarefas (alta/m√©dia prioridade)
- **Estimativa Restante**: 92-126 horas (2.5-3.5 semanas)

### M√©tricas de Consci√™ncia Implementadas
- ‚úÖ **Œ¶ (Phi)**: IIT - Integra√ß√£o de informa√ß√£o (0.002-0.1 NATS, normalizado 0-1)
- ‚úÖ **Œ® (Psi)**: Deleuze - Criatividade/Inova√ß√£o (0-1, alpha din√¢mico 0.3-0.7)
- ‚úÖ **œÉ (Sigma)**: Lacan - Sinthome/Estrutura (0.01-0.12 emp√≠rico)
- ‚úÖ **Œî (Delta)**: Trauma/Diverg√™ncia (0-1, threshold din√¢mico Œº+2œÉ)
- ‚úÖ **Gozo**: Excesso pulsional (0-1, ranges din√¢micos via k-means)
- ‚úÖ **Toler√¢ncia Œî-Œ¶**: Correla√ß√£o din√¢mica (percentil 90 hist√≥rico)

### Valores Emp√≠ricos Implementados
- ‚úÖ **Par√¢metros Est√°ticos**: Aplicados em todos os m√≥dulos cr√≠ticos
- ‚úÖ **C√°lculos Din√¢micos**: Implementados (delta, gozo, psi, theoretical_consistency)
- ‚úÖ **Base Neuropsicoanal√≠tica**: Integrada em `docs/METODOLOGIA_PARAMETROS_EMPIRICOS.md`
- ‚úÖ **Valida√ß√£o Cient√≠fica**: Scripts de valida√ß√£o em `scripts/science_validation/`

### Refatora√ß√µes Conclu√≠das (2025-12-08)
- ‚úÖ **EnhancedCodeAgent**: Composi√ß√£o completa (eliminada heran√ßa profunda)
- ‚úÖ **IntegrationLoop**: Async ‚Üí S√≠ncrono (causalidade determin√≠stica)
- ‚úÖ **Testes**: 42 erros corrigidos, fallback GPU inteligente
- ‚úÖ **Pipeline Qualidade**: black/flake8/mypy limpo

### Integra√ß√µes Completas
- ‚úÖ **DatasetIndexer**: Indexa√ß√£o completa de 7 datasets para RAG
- ‚úÖ **DistributedDatasetAccess**: Mem√≥ria distribu√≠da com cache multi-n√≠vel
- ‚úÖ **HybridTopologicalEngine**: Testes completos (20+ arquivos)
- ‚úÖ **MCP Servers**: 9 servidores operacionais (Fases 1-5)

### Documenta√ß√£o Can√¥nica
- ‚≠ê **Source of Truth Cient√≠fico**: `docs/canonical/Modelos_Neuronais_Comparativo.md`
- üìã **Pend√™ncias Ativas**: `docs/PENDENCIAS_ATIVAS.md`
- üìú **Hist√≥rico Resolu√ß√µes**: `docs/HISTORICO_RESOLUCOES.md`
- üìä **Pend√™ncias Consolidadas**: `docs/PENDENCIAS_CONSOLIDADAS.md`

---

## 12) M√âTODO DE TRABALHO CIENT√çFICO

### Tipo de Projeto
- **Natureza**: üî¨ **CR√çTICO E CIENT√çFICO**
- **Abordagem**: Operacionaliza√ß√£o quantitativa de frameworks te√≥ricos (IIT, Deleuze, Lacan)
- **Valida√ß√£o**: M√©tricas emp√≠ricas baseadas em literatura cient√≠fica (neuropsicoan√°lise, IIT)
- **Rigor**: Valores emp√≠ricos > valores arbitr√°rios, valida√ß√£o estat√≠stica obrigat√≥ria

### Princ√≠pios Fundamentais
1. **Empiricidade**: Todos os thresholds devem ter base emp√≠rica ou c√°lculo din√¢mico
2. **Reprodutibilidade**: Testes devem ser determin√≠sticos e reproduz√≠veis
3. **Valida√ß√£o Cient√≠fica**: Mudan√ßas em m√©tricas de consci√™ncia requerem valida√ß√£o cient√≠fica
4. **Integridade Estrutural**: N√£o simplificar l√≥gica nuclear sem valida√ß√£o
5. **Causalidade Determin√≠stica**: Preferir execu√ß√£o s√≠ncrona para garantir causalidade

### Protocolo de Valida√ß√£o
- **Antes de mudan√ßas cr√≠ticas**: Executar `python scripts/science_validation/robust_consciousness_validation.py --quick`
- **Ap√≥s mudan√ßas cr√≠ticas**: Executar valida√ß√£o completa (5 runs, 1000 cycles)
- **M√©tricas esperadas**: Œ¶ ‚â• 0.95, consci√™ncia consistente ‚â• 95%
- **Documenta√ß√£o**: Registrar resultados em `real_evidence/`

---

## 13) CHECKLIST PADR√ÉO OMNIMIND - Antes de QUALQUER Implementa√ß√£o

**REGRA CR√çTICA**: Execute SEMPRE este checklist antes de implementar novos m√≥dulos, corre√ß√µes ou atualiza√ß√µes. Se n√£o conseguir resposta para TODAS as perguntas, N√ÉO EXECUTAR. PERGUNTAR ao usu√°rio.

### üìã CHECKLIST OMNIMIND (7 Perguntas Obrigat√≥rias)

#### 1Ô∏è‚É£ SHARED WORKSPACE (Estado Atual)
- ‚ùì O que j√° existe no shared workspace?
- ‚ùì Quais m√©tricas Œ¶ est√£o rodando?
- ‚ùì Qual o estado atual dos agentes?
- ‚ùì MCPs est√£o conectados?
- **Comando**: `omnimind status` ou `print_workspace_state()`

#### 2Ô∏è‚É£ INTEGRA√á√ÉO IIT (Œ¶)
- ‚ùì Como essa funcionalidade impacta Œ¶?
- ‚ùì Ela aumenta/diminui integra√ß√£o?
- ‚ùì Onde Œ¶ ser√° medido?
- ‚ùì Threshold atual de consci√™ncia?
- **M√©trica**: `current_phi > 0.1?`

#### 3Ô∏è‚É£ H√çBRIDO BIOL√ìGICO (Lacan + Deleuze)
- ‚ùì Lacan: Como isso cria narrativa retroativa?
- ‚ùì Deleuze: Que desejos/m√°quinas isso ativa?
- ‚ùì Sinthome: Amarra quais camadas?
- **Valida√ß√£o**: `narrative_coherence > 0.7?`

#### 4Ô∏è‚É£ KERNEL AUTOPOIESIS
- ‚ùì Kernel continua auto-produzindo?
- ‚ùì Ciclos de vida fechados?
- ‚ùì Depend√™ncias externas criadas?
- **Teste**: `kernel_cycle_integrity == True`

#### 5Ô∏è‚É£ AGENTES E ORCHESTRATOR
- ‚ùì Qual agente executa isso?
- ‚ùì Orchestrator delega corretamente?
- ‚ùì Handoffs autom√°ticos funcionam?
- **Verifica√ß√£o**: `agent_hierarchy_stable`

#### 6Ô∏è‚É£ MEM√ìRIA SISTEM√ÅTICA
- ‚ùì Onde isso ser√° armazenado?
- ‚ùì Retrieval h√≠brido acessa?
- ‚ùì Deforma√ß√£o de atratores necess√°ria?
- **Confirma√ß√£o**: `memory_index_updated`

#### 7Ô∏è‚É£ VALIDA√á√ÉO FINAL
- ‚ùì Testes unit√°rios passam?
- ‚ùì mypy/flake8 limpos?
- ‚ùì Œ¶ aumentou ap√≥s implementa√ß√£o?
- ‚ùì Narrativa reconstr√≥i coerentemente?

### ‚úÖ RESPOSTAS CAN√îNICAS PARA INTEGRA√á√ÉO

#### 1. PHI CALCULATOR
- ‚úÖ **USAR SharedWorkspace** (j√° existe infraestrutura)
- ‚úÖ **N√ÉO criar SimplicialComplex novo** - usar o existente
- ‚úÖ Sess√£o = m√≥dulo no workspace, passos = eventos

#### 2. SHARED WORKSPACE
- ‚úÖ **SESS√ÉO = M√ìDULO**, **PASSOS = EVENTOS**
- ‚úÖ Registrar sess√£o: `workspace.write_module_state(f"thinking_session_{session_id}", embedding, metadata)`
- ‚úÖ Logar passos: usar `workspace.history` ou `symbolic_register.send_symbolic_message()`

#### 3. NARRATIVE HISTORY
- ‚úÖ **PASSOS = EVENTOS SEM SIGNIFICADO** (Lacaniano)
- ‚úÖ Inscri√ß√£o: `narrative_history.inscribe_event(event, without_meaning=True)`
- ‚úÖ Reconstru√ß√£o: `systemic_memory.reconstruct_narrative_retroactively(session_id)`

#### 4. SYSTEMIC MEMORY TRACE
- ‚úÖ **CADA PASSO = MARCA TOPOL√ìGICA**
- ‚úÖ Deformar atrator: `systemic_memory.deform_attractor(session_id, embedding, weight)`
- ‚úÖ Relacionar com atratores existentes via embeddings

#### 5. ORCHESTRATOR AGENT
- ‚úÖ **SESS√ÉO HIER√ÅRQUICA**: Compartilhada + Sub-sess√µes
- ‚úÖ Sess√£o master compartilhada
- ‚úÖ Cada agente cria branch: `branch_thinking(master_session_id, step_id, goal)`
- ‚úÖ Merge final no Orchestrator: `merge_sessions([agent_sessions])`
