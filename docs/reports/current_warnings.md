# Warnings ativos (Pytest & mypy)

- **ResourceWarning (asyncio.event_loop)** – Ao rodar `pytest -vv -W default` ainda aparece `ResourceWarning: unclosed event loop <_UnixSelectorEventLoop ...>` de fixtures `pytest-asyncio`. O warning permanece documentado e será resolvido com revisão do fluxo async mais adiante.
- **Mypy backlog (100+ erros)** – Após os ciclos de DBus/GraphQL/Supabase/memória, `mypy src tests` ainda reporta erros críticos nos módulos de auditoria (`tests/test_audit.py`), integrações (DBus, MCP, GraphQL), agentes React/Code e testes de dashboard/agents. Esses erros bloqueiam o ambiente e precisam ser atacados módulo a módulo conforme prioridade de estabilidade.
- **ReactAgent/CodeAgent/backend typing** – O ciclo atual levantou erros adicionais em `src/agents/react_agent.py` (tipagem de grafos e chamadas `invoke`), `src/agents/code_agent.py` (categorias de ferramentas) e `web/backend/main.py` (vários `type: ignore` obsoletos). Esses blocos são a causa imediata da falha no `mypy tests/test_dashboard_e2e.py` e devem ser o foco do próximo ciclo de correção.
- **Black falhando em arquivos de demonstração antigos** – `black .` não consegue parsear `archive/examples/demo_phase6.py` e `demo_phase6_backup.py` porque eles contêm uma expressão inválida (`tools_by_str(category)s()`). São arquivos legacy; mantenha-os fora do ciclo principal até que a sintaxe seja corrigida ou removida.
- **Flake8 rodando sobre dependências vendorizadas** – A execução `flake8 .` gerou centenas de erros dentro de `.venv/lib/python3.12/site-packages/` (PyYAML, zstandard, yarl, etc.). Isso polui os reports e não afeta o core OmniMind; ignore esses warnings até termos uma estratégia para limitar o lint à raiz `src/ tests/` ou usar `--exclude=".venv"`.
- **Mypy exigindo typing e novos stubs** – Com a fusão dos experimentos/métricas/otimização, `mypy src tests` caiu para ~95 erros:
  1. `structlog` chegou agora como dependência, mas o stub `types-structlog` não existe; o import é resolvido (biblioteca instalada), mas o tipo continua ausente. Avaliar criação de stub local ou `ignore_missing_imports = True` específico para esse pacote.
  2. `experiments` e `tests/metrics` precisam de docstrings/annotations completas (decisões em `DecisionLog`, funções de setup, loops de testes). Há também fixtures em `tests/conftest.py` e `_phase8` exigindo remoção de `type: ignore` e ajustes.
  3. `src/agents/react_agent_broken.py` e `tests/test_agents_*` continuam com `StateGraph`/atributos sem typing e `unused-ignore` gerando erros.
  4. `tests/test_agents_phase8.py` precisa expor `QdrantClient`/models em `src.memory.episodic_memory` (já notado em blocos anteriores); o backlog agora inclui novas chamadas nos módulos de métricas.
  5. Planejar correções modulares e commits granulares para zerar esses erros; cada bloco limpo deve ser validado com todo o ciclo (black, flake8, mypy, pytest).
- **Sincronização remota completa** – Executei `git fetch --all`, stashei as alterações locais, fiz `git pull --rebase`, resolvi os conflitos e apliquei o stash. O workspace agora reflete o histórico remoto (incluindo merges aprovados pelo agente) e está pronto para continuar o ciclo de validação local.
- **Remoção de demos legados inválidos** – `archive/examples/demo_phase6.py` e `archive/examples/demo_phase6_backup.py` foram excluídos (`chore: remove legacy demo files blocking formatter`) porque contêm sintaxe inválida (`tools_by_str(category)s()`) que impede o `black .`; manter esses arquivos apenas como referência exige esforço desproporcional. A exclusão foi documentada aqui e nos guias operacionais, e as pastas legadas permanecem fora dos ciclos de lint/compliance.
- **Flake8 focado no core** – Atualizei o `.flake8` para `exclude = .venv,archive/examples/*` (além das outras entradas) para impedir que dependências vendorizadas e demos legados poluam o relatório e garantir que apenas o código ativo seja verificado.
- **Flake8 ainda alerta em scripts antigos** – Mesmo após os exclusions, `flakes` reporta dezenas de problemas em `scripts/benchmarks/benchmark_phase6.py`, `scripts/fix_completion.py` e `tmp/workflow_test.py`. Esses arquivos fazem parte de ferramentas legadas e foram mantidos fora do ciclo principal por enquanto; documentei os avisos aqui para futura limpeza (os erros são `E402`, `W293`, `E302`, `E501`, `F401`, etc.).

> Atualize esse arquivo assim que qualquer warning for adicionado ou eliminado. Mantenha o histórico para onboarding futuros e referencie-o nos commits que lidam com os bloqueios listados.

✅ BLOCO 1 COMPLETO E VALIDADO: src/metrics, tests/metrics, typings/structlog.pyi — zero mypy errors, 111 testes passando
